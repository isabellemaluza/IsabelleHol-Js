theory StackMachine
  imports Main
begin

datatype instr = Load nat | Write | Noop

fun exec :: "instr \<Rightarrow> nat list \<Rightarrow> nat list \<Rightarrow> (nat list * nat list)" where
  "exec (Load n) stack out = (n # stack, out)" |
  "exec Write [] out = ([], out)" |
  "exec Write (x # xs) out = (xs, x # out)" |
  "exec Noop stack out = (stack, out)"

fun run_full :: "instr list \<Rightarrow> (nat list * nat list)" where
  "run_full [] = ([], [])" |
  "run_full (i # is) =
     (let (stack, out) = run_full is in exec i stack out)"

fun run :: "instr list \<Rightarrow> nat list" where
  "run prog = snd (run_full (rev prog))"

value "run [Load 3, Load 5, Write, Noop, Load 7, Write, Write]"
(* resultado: [5, 7, 3] *)

end
